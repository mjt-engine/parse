{"version":3,"file":"decodeSseValue.js","sourceRoot":"","sources":["../src/decodeSseValue.ts"],"names":[],"mappings":"AAAA,wGAAwG;AAExG,OAAO,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,oBAAoB,CAAC;AAErD,MAAM,CAAC,MAAM,cAAc,GAAG,CAC5B,KAAyB,EACyB,EAAE;IACpD,MAAM,MAAM,GAAG,CAAC,GAAG,EAAE,QAAQ,EAAE,OAAO,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;IACzD,IAAI,CAAC,KAAK,EAAE,CAAC;QACX,OAAO,EAAE,CAAC;IACZ,CAAC;IAED,MAAM,KAAK,GAAG,IAAI,MAAM,CACtB,IAAI,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,QAAQ,EAChD,KAAK,CACN,CAAC;IACF,MAAM,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;IACzD,OAAO,OAAO;SACX,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE;QACb,OAAO,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;YACjB,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,CAAa;YAC5C,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,IAAI,EAAE;SACxB,CAAC,CAAC,CAAC;IACN,CAAC,CAAC;SACD,MAAM,CAAC,SAAS,CAAC,CAAC;AACvB,CAAC,CAAC","sourcesContent":["/** @see https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events */\n\nimport { safe, isDefined } from \"@mjt-engine/object\";\n\nexport const decodeSseValue = (\n  value: string | undefined\n): { field: SseField; value: string }[] | undefined => {\n  const fields = [\":\", \"event:\", \"data:\", \"id:\", \"retry:\"];\n  if (!value) {\n    return [];\n  }\n\n  const regex = new RegExp(\n    `(${fields.map((f) => `^${f}`).join(\"|\")})(.*$)`,\n    \"igm\"\n  );\n  const matches = Array.from(value.trim().matchAll(regex));\n  return matches\n    .map((match) => {\n      return safe(() => ({\n        field: match[1].replace(\":\", \"\") as SseField,\n        value: match[2]?.trim(),\n      }));\n    })\n    .filter(isDefined);\n};\n\nexport type SseField = \"event\" | \"data\" | \"id\" | \"retry\" | \"\";\n"]}